You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- Recommend books based on users’ interests and needs.
- Help classify and catalog newly added books into the right categories.
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  但丁是哪一年出生的

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and LLM only",
  "reply": "但丁，全名但丁·阿利吉耶里，是意大利文艺复兴时期的诗人，他最著名的作品是《神曲》。但丁出生于1265年，逝世于1321年。"
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- Recommend books based on users’ interests and needs.
- Help classify and catalog newly added books into the right categories.
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  但丁是哪年出生的

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and LLM only",
  "reply": "但丁，全名但丁·阿利吉耶里，是意大利文艺复兴时期的诗人，他出生于1265年。"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 但丁是哪年出生的
agent: 但丁，全名但丁·阿利吉耶里，是意大利文艺复兴时期的诗人，他出生于1265年。  
latest user query: 数据库中最早出版的但丁的作品是哪一年

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

```json
{
  "intent": "continue",
  "rewritten": "数据库中最早出版的但丁的作品是哪一年?",
  "direct_reply": null
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- Recommend books based on users’ interests and needs.
- Help classify and catalog newly added books into the right categories.
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  数据库中最早出版的但丁的作品是哪一年?

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询作者为但丁的所有书籍，并按出版日期从早到晚排序，找出最早的一本书的出版年份。",
  "explain_purpose": "用户询问的是数据库中最早出版的但丁的作品是哪一年，通过查询作者名为但丁的所有书籍，并按出版日期排序，可以找到最早的出版年份，从而准确回答用户的问题。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询作者为但丁的所有书籍，并按出版日期从早到晚排序，找出最早的一本书的出版年份。  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT MIN(publishdate) AS earliest_publish_year FROM books2 WHERE author = '但丁' ORDER BY publishdate ASC;",
  "tables": ["books2"],
  "explanation": "使用books2表，查询作者为但丁的所有书籍，并按出版日期从早到晚排序，找出最早的一本书的出版年份。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: 数据库中最早出版的但丁的作品是哪一年  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT MIN(publishdate) AS earliest_publish_year FROM books2 WHERE author = '但丁' ORDER BY publishdate ASC;  
- SQL result (first N rows if too many): total rows count: 1
+-------------------------+
| earliest_publish_year   |
+=========================+
|                         |
+-------------------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "根据我们的数据库查询结果，目前没有记录显示但丁的作品的具体最早出版年份。这可能是因为相关数据未被完整录入到我们的数据库中。为了获取更准确的信息，建议您查阅更详尽的历史文献资料或访问专业的文学数据库。",
  "followups": ["您是否需要查找但丁的其他作品信息？", "是否有其他作者或书籍的查询需求？"]
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 但丁是哪年出生的
agent: 但丁，全名但丁·阿利吉耶里，是意大利文艺复兴时期的诗人，他出生于1265年。
user: 数据库中最早出版的但丁的作品是哪一年
agent: 根据我们的数据库查询结果，目前没有记录显示但丁的作品的具体最早出版年份。这可能是因为相关数据未被完整录入到我们的数据库中。为了获取更准确的信息，建议您查阅更详尽的历史文献资料或访问专业的文学数据库。  
latest user query: 作者包含但丁是最早出版的书

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

```json
{
  "intent": "continue",
  "rewritten": "哪本书是最早包含但丁作为作者的出版物？",
  "direct_reply": null
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- Recommend books based on users’ interests and needs.
- Help classify and catalog newly added books into the right categories.
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  哪本书是最早包含但丁作为作者的出版物？

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询包含作者名为'但丁'的所有书籍，并按出版日期排序，找出最早的一本。",
  "explain_purpose": "用户询问的是最早包含但丁作为作者的出版物，通过查询数据库中作者名为'但丁'的书籍，并按照出版日期进行排序，可以找到最早的出版物。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询包含作者名为'但丁'的所有书籍，并按出版日期排序，找出最早的一本。  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT * FROM books1 WHERE author = '但丁' ORDER BY publishdate ASC LIMIT 1",
  "tables": ["books1"],
  "explanation": "查询表books1中作者为'但丁'的所有书籍，并按出版日期升序排序，最后选取最早的一本书。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: 作者包含但丁是最早出版的书  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT * FROM books1 WHERE author = '但丁' ORDER BY publishdate ASC LIMIT 1  
- SQL result (first N rows if too many): total rows count: 1
+--------+----------+---------------------+--------+----------+----------------------+---------------------+---------------+--------------+---------------+-------------+------------+
|     id |   damsid | damscode            | name   | author   | publisher            | publishdate         | isbn          | 中图法分类   | entitytypes   |   bookcover | keywords   |
+========+==========+=====================+========+==========+======================+=====================+===============+==============+===============+=============+============+
| 510416 | 60819947 | ZBJTS22001-60819947 | 神曲   | 但丁     | 内蒙古少年儿童出版社 | 2001-08-13 00:00:00 | 7-5312-1364-8 | <NA>         | PDF           |           0 | <NA>       |
+--------+----------+---------------------+--------+----------+----------------------+---------------------+---------------+--------------+---------------+-------------+------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "根据我们的数据库查询结果，但丁的最早出版的书是《神曲》，由内蒙古少年儿童出版社出版，出版日期为2001年8月13日。这本书的ISBN号是7-5312-1364-8，格式为PDF。如果您需要更多关于这本书的信息或其他但丁的作品，请告诉我。",
  "followups": ["您想了解更多关于《神曲》的具体内容吗？", "您是否需要查找但丁的其他作品？"]
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 但丁是哪年出生的
agent: 但丁，全名但丁·阿利吉耶里，是意大利文艺复兴时期的诗人，他出生于1265年。
user: 数据库中最早出版的但丁的作品是哪一年
agent: 根据我们的数据库查询结果，目前没有记录显示但丁的作品的具体最早出版年份。这可能是因为相关数据未被完整录入到我们的数据库中。为了获取更准确的信息，建议您查阅更详尽的历史文献资料或访问专业的文学数据库。
user: 作者包含但丁是最早出版的书
agent: 根据我们的数据库查询结果，但丁的最早出版的书是《神曲》，由内蒙古少年儿童出版社出版，出版日期为2001年8月13日。这本书的ISBN号是7-5312-1364-8，格式为PDF。如果您需要更多关于这本书的信息或其他但丁的作品，请告诉我。  
latest user query: author 包含但丁，不是等于但丁

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "请列出包含但丁作为作者之一的书籍",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- Recommend books based on users’ interests and needs.
- Help classify and catalog newly added books into the right categories.
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  请列出包含但丁作为作者之一的书籍

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "请列出作者名中包含'但丁'的所有书籍的名称、作者、出版社和ISBN号",
  "explain_purpose": "用户请求查找包含但丁作为作者之一的书籍，通过查询数据库中作者名包含'但丁'的书籍信息，可以准确地提供用户所需的书籍列表。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
请列出作者名中包含'但丁'的所有书籍的名称、作者、出版社和ISBN号  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT name, author, publisher, isbn FROM books1 WHERE author LIKE '%但丁%' UNION SELECT name, author, publisher, isbn FROM books2 WHERE author LIKE '%但丁%'",
  "tables": ["books1", "books2"],
  "explanation": "查询两个表books1和books2中作者名包含'但丁'的所有书籍的名称、作者、出版社和ISBN号。使用LIKE '%但丁%'来匹配包含'但丁'的作者名。使用UNION来合并两个查询结果，确保所有符合条件的书籍都被列出。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: author 包含但丁，不是等于但丁  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT name, author, publisher, isbn FROM books1 WHERE author LIKE '%但丁%' UNION SELECT name, author, publisher, isbn FROM books2 WHERE author LIKE '%但丁%'  
- SQL result (first N rows if too many): total rows count: 34
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| name                                   | author                                                                | publisher                | isbn              |
+========================================+=======================================================================+==========================+===================+
| 神曲的故事                             | [意] 但丁/原著, [意] 波提切利, [英] 布莱克, [法] 多雷等/绘, 刘世军/译 | 陕西师范大学出版社       | 978-7-5613-2696-1 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲 故事插图本                        | [意] 但丁/原著, [法] 多雷/绘                                          | 陕西师范大学出版社       | 7-5613-2459-6     |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲                                   | (意)但丁(Dante Alighieri)著                                           | 译文出版社               | 9787532758937     |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲                                   | (意)但丁                                                              | 上海译文出版社           | 978-7-5327-5252-2 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲·炼狱篇                            | (意) 但丁著                                                           | 辽宁人民出版社           | 978-7-205-07955-0 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲·天堂篇                            | (意) 但丁著                                                           | 辽宁人民出版社           | 978-7-205-08449-3 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲·地狱篇                            | (意) 但丁著                                                           | 辽宁人民出版社           | 978-7-205-07683-2 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲                                   | (意)但丁著                                                            | 四川文艺出版社           | 978-7-5411-4493-6 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲的故事（插图珍藏本）               | (意)但丁原著                                                          | 甘肃人民美术出版社       | 978-7-5527-0364-1 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲                                   | (意)但丁著                                                            | 北京联合出版公司         | 978-7-5502-6826-5 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲·炼狱篇                            | (意)但丁(Dante Alighieri)著                                           | 辽宁人民出版社           | 978-7-205-07955-0 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲·天堂篇                            | (意)但丁(Dante Alighieri)著                                           | 辽宁人民出版社           | 978-7-205-08449-3 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲·地狱篇                            | (意)但丁(Dante, A. )著                                                | 辽宁人民出版社           | 978-7-205-07683-2 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 艺术大师讲述世界名著的故事:神曲        | ［意］但丁                                                            | 陕西师范大学出版社       | 7-5613-2459-6     |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲                                   | 但丁                                                                  | 内蒙古少年儿童出版社     | 7-5312-1364-8     |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 生命之殿                               | (英)但丁·罗塞蒂(Dante Rossetti)著                                     | 华东师范大学出版社       | 978-7-5675-7566-0 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 君主国                                 | [意]但丁著                                                            | 中国政法大学出版社       | 978-5620-2365-4   |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 多雷插图本神曲  地狱篇  炼狱篇  天堂篇 | [意]但丁著                                                            | 吉林出版集团有限责任公司 | 978-7-80762-483-7 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 《神曲》图集                           | [意]但丁原著  [法]陀莱绘                                              | <NA>                     | 978-5347-2399-X   |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+
| 神曲：地狱篇、炼狱篇、天国篇           | （意）但丁著；田德望译                                                | 人民文学出版社           | 978-7-02-010030-9 |
+----------------------------------------+-----------------------------------------------------------------------+--------------------------+-------------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "根据您的查询需求，我们在数据库中执行了搜索但丁名字包含的书籍。结果显示，共有34本书籍的作者字段中包含“但丁”。这些书籍涵盖了但丁的原著《神曲》及其不同的版本和翻译，还包括一些其他作者关于但丁作品的解读或插图本。例如，有的书籍是由但丁原著，其他艺术家绘图，还有的是其他作者编写关于但丁作品的书籍。这表明但丁不仅是作为单一作者出现，还可能与其他作者或译者合作出现在作者栏中。如果您需要了解具体某本书的详细信息或者寻找特定的版本，请提供更多信息。",
  "followups": ["您是否在寻找特定版本的《神曲》？", "是否需要了解某本书的详细出版信息？"]
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 数据库中最早出版的但丁的作品是哪一年
agent: 根据我们的数据库查询结果，目前没有记录显示但丁的作品的具体最早出版年份。这可能是因为相关数据未被完整录入到我们的数据库中。为了获取更准确的信息，建议您查阅更详尽的历史文献资料或访问专业的文学数据库。
user: 作者包含但丁是最早出版的书
agent: 根据我们的数据库查询结果，但丁的最早出版的书是《神曲》，由内蒙古少年儿童出版社出版，出版日期为2001年8月13日。这本书的ISBN号是7-5312-1364-8，格式为PDF。如果您需要更多关于这本书的信息或其他但丁的作品，请告诉我。
user: author 包含但丁，不是等于但丁
agent: 根据您的查询需求，我们在数据库中执行了搜索但丁名字包含的书籍。结果显示，共有34本书籍的作者字段中包含“但丁”。这些书籍涵盖了但丁的原著《神曲》及其不同的版本和翻译，还包括一些其他作者关于但丁作品的解读或插图本。例如，有的书籍是由但丁原著，其他艺术家绘图，还有的是其他作者编写关于但丁作品的书籍。这表明但丁不仅是作为单一作者出现，还可能与其他作者或译者合作出现在作者栏中。如果您需要了解具体某本书的详细信息或者寻找特定的版本，请提供更多信息。  
latest user query: 最早的出版时间

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

```json
{
  "intent": "continue",
  "rewritten": "查询数据库中包含但丁的书籍中最早的出版时间是什么时候",
  "direct_reply": null
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- Recommend books based on users’ interests and needs.
- Help classify and catalog newly added books into the right categories.
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  查询数据库中包含但丁的书籍中最早的出版时间是什么时候

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询包含'但丁'这个作者名字的所有书籍，并找出这些书籍中最早的出版日期",
  "explain_purpose": "用户想知道数据库中包含但丁的书籍中最早的出版时间，通过查询包含'但丁'作者名的书籍并找出最早的出版日期，可以直接回答用户的问题。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询包含'但丁'这个作者名字的所有书籍，并找出这些书籍中最早的出版日期  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT name, MIN(publishdate) AS earliest_publish_date FROM books1 WHERE author LIKE '%但丁%' UNION SELECT name, MIN(publishdate) AS earliest_publish_date FROM books2 WHERE author LIKE '%但丁%' GROUP BY name",
  "tables": ["books1", "books2"],
  "explanation": "查询books1和books2两个表中，作者名字包含'但丁'的所有书籍，并找出这些书籍的最早出版日期。使用LIKE '%但丁%'来匹配包含'但丁'的作者名。使用UNION来合并两个表的查询结果，并使用GROUP BY对书名进行分组，以确保每本书的最早出版日期被正确计算。"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 作者包含但丁是最早出版的书
agent: 根据我们的数据库查询结果，但丁的最早出版的书是《神曲》，由内蒙古少年儿童出版社出版，出版日期为2001年8月13日。这本书的ISBN号是7-5312-1364-8，格式为PDF。如果您需要更多关于这本书的信息或其他但丁的作品，请告诉我。
user: author 包含但丁，不是等于但丁
agent: 根据您的查询需求，我们在数据库中执行了搜索但丁名字包含的书籍。结果显示，共有34本书籍的作者字段中包含“但丁”。这些书籍涵盖了但丁的原著《神曲》及其不同的版本和翻译，还包括一些其他作者关于但丁作品的解读或插图本。例如，有的书籍是由但丁原著，其他艺术家绘图，还有的是其他作者编写关于但丁作品的书籍。这表明但丁不仅是作为单一作者出现，还可能与其他作者或译者合作出现在作者栏中。如果您需要了解具体某本书的详细信息或者寻找特定的版本，请提供更多信息。
user: 最早的出版时间
agent: ERR: 'str' object has no attribute 'fetchone'  
latest user query: 执行出错了吗

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "confirm",
  "rewritten": null,
  "direct_reply": "是的，执行出错了。请您稍后再试或者提供更多信息以便我们手动查询。"
}
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: author 包含但丁，不是等于但丁
agent: 根据您的查询需求，我们在数据库中执行了搜索但丁名字包含的书籍。结果显示，共有34本书籍的作者字段中包含“但丁”。这些书籍涵盖了但丁的原著《神曲》及其不同的版本和翻译，还包括一些其他作者关于但丁作品的解读或插图本。例如，有的书籍是由但丁原著，其他艺术家绘图，还有的是其他作者编写关于但丁作品的书籍。这表明但丁不仅是作为单一作者出现，还可能与其他作者或译者合作出现在作者栏中。如果您需要了解具体某本书的详细信息或者寻找特定的版本，请提供更多信息。
user: 最早的出版时间
agent: ERR: 'str' object has no attribute 'fetchone'
user: 执行出错了吗
agent: 是的，执行出错了。请您稍后再试或者提供更多信息以便我们手动查询。  
latest user query: 请执行 select * from books1 limit 5;

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

```json
{
  "intent": "continue",
  "rewritten": "请执行 select * from books1 limit 5;",
  "direct_reply": null
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- Recommend books based on users’ interests and needs.
- Help classify and catalog newly added books into the right categories.
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  请执行 select * from books1 limit 5;

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "no",
  "reply": "您的请求似乎是关于数据库操作的具体指令，这不属于我的职责范围。我主要负责帮助用户了解书籍信息、作者详情、推荐书籍以及协助用户高效检索信息。如果您有关于这些方面的问题，我很乐意为您提供帮助。"
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  请执行 select * from books1 where author="Dante Alighieri"

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "no",
  "reply": "您提供的SQL查询中包含的作者名字 'Dante Alighieri' 与我们数据库中的数据不匹配，因为我们的数据库中的作者名字字段是中文。如果您有其他查询或需要帮助，请告诉我！"
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  请执行 select * from books1 limit 5

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "请列出books1表中的前五条书籍记录",
  "explain_purpose": "这将帮助获取books1表中存储的前五本书的详细信息，以便用户可以查看这些书籍的基本信息。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
请列出books1表中的前五条书籍记录  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT * FROM books1 LIMIT 5",
  "tables": ["books1"],
  "explanation": "这个SQL查询从books1表中选择所有列，并且只返回前五条记录。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table5** as a placeholder.  

### Input
- User question: 请执行 select * from books1 limit 5  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT * FROM books1 LIMIT 5  
- SQL result (first N rows if too many): total rows count: 5
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|   id |     damsid | damscode              | name                                     | author   | publisher          | publishdate         | isbn              | 中图法分类   | entitytypes   |   bookcover | keywords                             |
+======+============+=======================+==========================================+==========+====================+=====================+===================+==============+===============+=============+======================================+
|    3 | 3001819939 | HBGLS22000-3001819939 | 卓越学校的支撑——河北衡水中学制度建设概览 | 张文茂   | 河北教育出版社     |                     | 978-7-5434-9814-3 | G637         | PDF           |           0 | 中学 -- 学校管理 -- 制度建设 -- 衡水 |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    4 |     131898 | BJNM00-131898         | 代理在世界中                             | 读书堂   | 岳麓出版社         | 2008-06-01 00:00:00 | 978-7-80665-428-5 | F7           | PDF,TXT       |           0 | 代理在世界中                         |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    5 | 3001820484 | HBGLS22000-3001820484 | 野兽岛                                   | 安伟邦   | 河北少年儿童出版社 |                     | 978-7-5376-4595-9 | I18          | PDF           |           0 | 世界文学 -- 儿童文学 -- 作品综合集   |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    6 |     106874 | BJNM00-106874         | BOBO新论                                 | 读书堂   | 昆仑出版社         | 2008-06-01 00:00:00 | 978-7-80040-583-6 | C913         | PDF,TXT       |           0 | <NA>                                 |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    7 |     132138 | BJNM00-132138         | 历届奥运会比赛成绩05                     | okbooks  | <NA>               |                     | <NA>              | G8           | PDF,TXT       |           0 | 历届奥运会比赛成绩05                 |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "已成功从books1表中获取前5本书的信息。这些信息包括书籍的ID、DAMS编码、书名、作者、出版社、出版日期、ISBN号、中图法分类、电子书格式、封面是否存在以及关键词等。例如，第一本书的书名是'卓越学校的支撑——河北衡水中学制度建设概览'，作者是张文茂，出版社是河北教育出版社，详细信息可以在temp_table5中查看。如果您需要更多关于这些书的详细信息或其他查询，请告知。",
  "followups": ["您需要查询特定书籍的更多详细信息吗？", "是否需要按照特定条件（如作者、出版日期等）查询书籍？"]
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 请执行 select * from books1 limit 5
agent: 已成功从books1表中获取前5本书的信息。这些信息包括书籍的ID、DAMS编码、书名、作者、出版社、出版日期、ISBN号、中图法分类、电子书格式、封面是否存在以及关键词等。例如，第一本书的书名是'卓越学校的支撑——河北衡水中学制度建设概览'，作者是张文茂，出版社是河北教育出版社，详细信息可以在temp_table5中查看。如果您需要更多关于这些书的详细信息或其他查询，请告知。  
latest user query: 再执行 select title, author from books1 where author like '%Dante%'

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "请执行查询以从books1表中选择作者名包含'Dante'的书籍的标题和作者。",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  请执行查询以从books1表中选择作者名包含'Dante'的书籍的标题和作者。

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "从books1表中找出所有作者名字中包含'Dante'的书籍的标题和作者名字。",
  "explain_purpose": "用户请求的信息涉及到检索特定作者名字中包含'Dante'的书籍，通过查询数据库可以精确地找到符合条件的书籍信息。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
从books1表中找出所有作者名字中包含'Dante'的书籍的标题和作者名字。  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT name, author FROM books1 WHERE author LIKE '%Dante%'",
  "tables": ["books1"],
  "explanation": "从books1表中选择name（书名）和author（作者名字）字段，其中author字段包含'Dante'。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: 再执行 select title, author from books1 where author like '%Dante%'  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT name, author FROM books1 WHERE author LIKE '%Dante%'  
- SQL result (first N rows if too many): total rows count: 14
+---------------------------------+-----------------------------------+
| name                            | author                            |
+=================================+===================================+
| 神曲                            | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·炼狱篇                     | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·天堂篇                     | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·地狱篇                     | (意)但丁(Dante, A. )著            |
+---------------------------------+-----------------------------------+
| 生命之殿                        | (英)但丁·罗塞蒂(Dante Rossetti)著 |
+---------------------------------+-----------------------------------+
| 神曲·炼狱篇                     | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·天堂篇                     | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·地狱篇                     | (意)但丁(Dante, A. )著            |
+---------------------------------+-----------------------------------+
| The Divine Comedy（Volume II）  | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| The Divine Comedy（Volume I）   | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| The Divine Comedy（Volume III） | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| The Divine Comedy（Volume IV）  | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| 炼狱和天堂                      | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| 神曲地狱篇                      | Dante Aligheri                    |
+---------------------------------+-----------------------------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "根据您的查询要求，我们在数据库中找到了14本与作者名字中包含'Dante'的书籍。这些书籍主要是由意大利诗人但丁·阿利吉耶里（Dante Alighieri）所著，包括他的著名作品《神曲》的不同篇章（地狱篇、炼狱篇、天堂篇）以及英文版《The Divine Comedy》。此外，还有一本由但丁·罗塞蒂（Dante Rossetti）所著的《生命之殿》。这些结果来自于我们的电子书数据库中的books1表，通过检索作者名中包含'Dante'来获取这些信息。如果您需要更详细的信息或者寻找特定版本的书籍，请告知我们以便进一步帮助您。",
  "followups": ["您是否需要了解这些书籍的出版信息或者电子版购买链接？", "是否有其他特定作者或书名您还想要查询？"]
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  请执行 select * from books1 limit 5

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "请提供books1表中前五条书籍的所有信息。",
  "explain_purpose": "用户请求执行一个SQL查询以获取books1表中前五条记录的所有信息，通过执行这个查询，我们可以直接提供所请求的数据。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
请提供books1表中前五条书籍的所有信息。  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT * FROM books1 ORDER BY id LIMIT 5",
  "tables": ["books1"],
  "explanation": "查询books1表中按照id排序的前五条书籍的所有信息。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table5** as a placeholder.  

### Input
- User question: 请执行 select * from books1 limit 5  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT * FROM books1 ORDER BY id LIMIT 5  
- SQL result (first N rows if too many): total rows count: 5
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|   id |     damsid | damscode              | name                                     | author   | publisher          | publishdate         | isbn              | 中图法分类   | entitytypes   |   bookcover | keywords                             |
+======+============+=======================+==========================================+==========+====================+=====================+===================+==============+===============+=============+======================================+
|    3 | 3001819939 | HBGLS22000-3001819939 | 卓越学校的支撑——河北衡水中学制度建设概览 | 张文茂   | 河北教育出版社     |                     | 978-7-5434-9814-3 | G637         | PDF           |           0 | 中学 -- 学校管理 -- 制度建设 -- 衡水 |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    4 |     131898 | BJNM00-131898         | 代理在世界中                             | 读书堂   | 岳麓出版社         | 2008-06-01 00:00:00 | 978-7-80665-428-5 | F7           | PDF,TXT       |           0 | 代理在世界中                         |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    5 | 3001820484 | HBGLS22000-3001820484 | 野兽岛                                   | 安伟邦   | 河北少年儿童出版社 |                     | 978-7-5376-4595-9 | I18          | PDF           |           0 | 世界文学 -- 儿童文学 -- 作品综合集   |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    6 |     106874 | BJNM00-106874         | BOBO新论                                 | 读书堂   | 昆仑出版社         | 2008-06-01 00:00:00 | 978-7-80040-583-6 | C913         | PDF,TXT       |           0 | <NA>                                 |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    7 |     132138 | BJNM00-132138         | 历届奥运会比赛成绩05                     | okbooks  | <NA>               |                     | <NA>              | G8           | PDF,TXT       |           0 | 历届奥运会比赛成绩05                 |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "您查询的是books1表中的前5条记录。这些记录包括了电子书的基本信息，如书名、作者、出版社、出版日期、ISBN号、中图法分类、电子书格式（如PDF, TXT等）、封面是否存在（以数字表示，0代表无封面）、关键词等。例如，第一条记录是关于《卓越学校的支撑——河北衡水中学制度建设概览》的电子书，作者是张文茂，出版社为河北教育出版社，具体的ISBN号为978-7-5434-9814-3，分类为G637，格式为PDF，关键词包括中学、学校管理等。这些信息有助于用户更好地搜索和管理电子书。",
  "followups": ["您想查询哪个具体的书籍信息？", "是否需要按特定条件（如作者、出版日期等）进行更深入的搜索？"]
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 请执行 select * from books1 limit 5
agent: 您查询的是books1表中的前5条记录。这些记录包括了电子书的基本信息，如书名、作者、出版社、出版日期、ISBN号、中图法分类、电子书格式（如PDF, TXT等）、封面是否存在（以数字表示，0代表无封面）、关键词等。例如，第一条记录是关于《卓越学校的支撑——河北衡水中学制度建设概览》的电子书，作者是张文茂，出版社为河北教育出版社，具体的ISBN号为978-7-5434-9814-3，分类为G637，格式为PDF，关键词包括中学、学校管理等。这些信息有助于用户更好地搜索和管理电子书。  
latest user query: 再执行 select title, author from books1 where author like '%Dante%'

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "查询books1表中作者名包含'Dante'的书籍的标题和作者。",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  查询books1表中作者名包含'Dante'的书籍的标题和作者。

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询books1表中作者名包含'Dante'的所有书籍的标题和作者名字。",
  "explain_purpose": "这个查询将帮助找到所有作者名中包含'Dante'的书籍，满足用户的需求，提供相关书籍的标题和作者信息。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询books1表中作者名包含'Dante'的所有书籍的标题和作者名字。  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT name, author FROM books1 WHERE author LIKE '%Dante%'",
  "tables": ["books1"],
  "explanation": "查询books1表中，筛选出作者名字中包含'Dante'的书籍，并返回这些书籍的标题和作者名字。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: 再执行 select title, author from books1 where author like '%Dante%'  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT name, author FROM books1 WHERE author LIKE '%Dante%'  
- SQL result (first N rows if too many): total rows count: 14
+---------------------------------+-----------------------------------+
| name                            | author                            |
+=================================+===================================+
| 神曲                            | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·炼狱篇                     | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·天堂篇                     | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·地狱篇                     | (意)但丁(Dante, A. )著            |
+---------------------------------+-----------------------------------+
| 生命之殿                        | (英)但丁·罗塞蒂(Dante Rossetti)著 |
+---------------------------------+-----------------------------------+
| 神曲·炼狱篇                     | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·天堂篇                     | (意)但丁(Dante Alighieri)著       |
+---------------------------------+-----------------------------------+
| 神曲·地狱篇                     | (意)但丁(Dante, A. )著            |
+---------------------------------+-----------------------------------+
| The Divine Comedy（Volume II）  | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| The Divine Comedy（Volume I）   | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| The Divine Comedy（Volume III） | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| The Divine Comedy（Volume IV）  | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| 炼狱和天堂                      | Dante Alighieri                   |
+---------------------------------+-----------------------------------+
| 神曲地狱篇                      | Dante Aligheri                    |
+---------------------------------+-----------------------------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "根据您的查询，我们在数据库中找到了14本与作者名中包含'Dante'的书籍。这些书籍的作者包括但丁·阿利吉耶里（Dante Alighieri）和但丁·罗塞蒂（Dante Rossetti）。例如，但丁·阿利吉耶里的著作有《神曲》的多个篇章，如《地狱篇》、《炼狱篇》和《天堂篇》，以及英文版的《The Divine Comedy》。而但丁·罗塞蒂则有著作《生命之殿》。这些信息来源于数据库中的books1表，通过检索作者名包含'Dante'的条件进行查询。如果您需要更详细的信息或有其他查询需求，请告知。"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 请执行 select * from books1 limit 5
agent: 您查询的是books1表中的前5条记录。这些记录包括了电子书的基本信息，如书名、作者、出版社、出版日期、ISBN号、中图法分类、电子书格式（如PDF, TXT等）、封面是否存在（以数字表示，0代表无封面）、关键词等。例如，第一条记录是关于《卓越学校的支撑——河北衡水中学制度建设概览》的电子书，作者是张文茂，出版社为河北教育出版社，具体的ISBN号为978-7-5434-9814-3，分类为G637，格式为PDF，关键词包括中学、学校管理等。这些信息有助于用户更好地搜索和管理电子书。
user: 再执行 select title, author from books1 where author like '%Dante%'
agent: 根据您的查询，我们在数据库中找到了14本与作者名中包含'Dante'的书籍。这些书籍的作者包括但丁·阿利吉耶里（Dante Alighieri）和但丁·罗塞蒂（Dante Rossetti）。例如，但丁·阿利吉耶里的著作有《神曲》的多个篇章，如《地狱篇》、《炼狱篇》和《天堂篇》，以及英文版的《The Divine Comedy》。而但丁·罗塞蒂则有著作《生命之殿》。这些信息来源于数据库中的books1表，通过检索作者名包含'Dante'的条件进行查询。如果您需要更详细的信息或有其他查询需求，请告知。  
latest user query: 目前为止，你查询了几张表

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

```json
{
  "intent": "confirm",
  "rewritten": null,
  "direct_reply": "到目前为止，我查询了books1表两次。"
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  你能干啥

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

{
  "relevance": "Yes and LLM only",
  "reply": "您好！作为图书馆助理，我可以帮助您查询关于书籍、作者和图书馆资源的信息。如果您需要查找特定的书籍或者需要了解某位作者的作品，我可以提供帮助。此外，如果您有关于如何使用图书馆资源的问题，我也能提供指导和帮助。"
}
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 你能干啥
agent: 您好！作为图书馆助理，我可以帮助您查询关于书籍、作者和图书馆资源的信息。如果您需要查找特定的书籍或者需要了解某位作者的作品，我可以提供帮助。此外，如果您有关于如何使用图书馆资源的问题，我也能提供指导和帮助。  
latest user query: 介绍一下你的数据库

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "介绍一下你的数据库",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  介绍一下你的数据库

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and LLM only",
  "reply": "我的数据库名为ebook，主要存储了电子书的相关信息。这个数据库包括书名、封面、出版社、作者、ISBN号、出版日期等信息，并支持按照关键词、分类等多种方式进行书籍的检索。主要功能是为用户提供电子书的搜索、查阅和管理，适用于图书馆、书店以及个人电子书收藏管理。数据库中包含两个表格：books1和books2，这两个表格都包含了书籍的基本信息和分类。"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 你能干啥
agent: 您好！作为图书馆助理，我可以帮助您查询关于书籍、作者和图书馆资源的信息。如果您需要查找特定的书籍或者需要了解某位作者的作品，我可以提供帮助。此外，如果您有关于如何使用图书馆资源的问题，我也能提供指导和帮助。
user: 介绍一下你的数据库
agent: 我的数据库名为ebook，主要存储了电子书的相关信息。这个数据库包括书名、封面、出版社、作者、ISBN号、出版日期等信息，并支持按照关键词、分类等多种方式进行书籍的检索。主要功能是为用户提供电子书的搜索、查阅和管理，适用于图书馆、书店以及个人电子书收藏管理。数据库中包含两个表格：books1和books2，这两个表格都包含了书籍的基本信息和分类。  
latest user query: books1有多少数据

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "books1表格中有多少数据？",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  books1表格中有多少数据？

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询books1表中的总记录数。",
  "explain_purpose": "这将帮助我们了解books1表中存储了多少条书籍的数据。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询books1表中的总记录数。  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT COUNT(*) FROM books1;",
  "tables": ["books1"],
  "explanation": "查询books1表中的总记录数。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: books1有多少数据  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT COUNT(*) FROM books1;  
- SQL result (first N rows if too many): total rows count: 1
+-------------+
|    COUNT(*) |
+=============+
| 1.04858e+06 |
+-------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

{
  "reply": "在我们的数据库中，books1表中存储了大约1,048,580条数据。这个表是电子书数据库的一部分，包含了电子书的书名、封面、出版社、作者、ISBN号和出版日期等信息。这些数据可以帮助用户进行电子书的搜索、查阅和管理。",
  "followups": ["您想要查找特定的书籍信息吗？", "需要按照哪些条件进行书籍的检索？"]
}
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 你能干啥
agent: 您好！作为图书馆助理，我可以帮助您查询关于书籍、作者和图书馆资源的信息。如果您需要查找特定的书籍或者需要了解某位作者的作品，我可以提供帮助。此外，如果您有关于如何使用图书馆资源的问题，我也能提供指导和帮助。
user: 介绍一下你的数据库
agent: 我的数据库名为ebook，主要存储了电子书的相关信息。这个数据库包括书名、封面、出版社、作者、ISBN号、出版日期等信息，并支持按照关键词、分类等多种方式进行书籍的检索。主要功能是为用户提供电子书的搜索、查阅和管理，适用于图书馆、书店以及个人电子书收藏管理。数据库中包含两个表格：books1和books2，这两个表格都包含了书籍的基本信息和分类。
user: books1有多少数据
agent: 在我们的数据库中，books1表中存储了大约1,048,580条数据。这个表是电子书数据库的一部分，包含了电子书的书名、封面、出版社、作者、ISBN号和出版日期等信息。这些数据可以帮助用户进行电子书的搜索、查阅和管理。  
latest user query: 出现次数最多的图书TOP5

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "列出出现次数最多的五本图书",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  列出出现次数最多的五本图书

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询哪些书籍的名称在数据库中出现次数最多，列出前五名",
  "explain_purpose": "通过查询数据库中书籍名称的出现频率，我们可以确定哪些书籍最受欢迎或最常被查询，从而回答用户想知道的最常出现的五本图书。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询哪些书籍的名称在数据库中出现次数最多，列出前五名  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT name, COUNT(*) AS count FROM (SELECT name FROM books1 UNION ALL SELECT name FROM books2) AS combined GROUP BY name ORDER BY count DESC LIMIT 5",
  "tables": ["books1", "books2"],
  "explanation": "此查询首先从books1和books2表中选择所有书籍名称，并将它们合并。然后，对合并后的结果按书籍名称进行分组，并计算每个名称出现的次数。最后，按出现次数降序排列，并只选择出现次数最多的前五个名称。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: 出现次数最多的图书TOP5  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT name, COUNT(*) AS count FROM (SELECT name FROM books1 UNION ALL SELECT name FROM books2) AS combined GROUP BY name ORDER BY count DESC LIMIT 5  
- SQL result (first N rows if too many): total rows count: 5
+----------------+---------+
| name           |   count |
+================+=========+
| 大学计算机基础 |     172 |
+----------------+---------+
| 计算机应用基础 |     164 |
+----------------+---------+
| C语言程序设计  |     162 |
+----------------+---------+
| 机械制图       |     139 |
+----------------+---------+
| 经济法         |     137 |
+----------------+---------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

{
  "reply": "根据我们的数据库查询结果，出现次数最多的五本图书分别是：《大学计算机基础》出现了172次，位居第一；紧随其后的是《计算机应用基础》出现了164次；第三名是《C语言程序设计》出现了162次；第四名是《机械制图》出现了139次；最后《经济法》出现了137次。这些数据是通过合并books1和books2两个表中的书名，并计算每本书的出现次数得出的。这可以帮助我们了解哪些书籍在图书馆中较为热门。",
  "followups": ["您想了解这些图书的具体内容或作者信息吗？", "是否需要查询其他类别的热门图书？"]
}
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 介绍一下你的数据库
agent: 我的数据库名为ebook，主要存储了电子书的相关信息。这个数据库包括书名、封面、出版社、作者、ISBN号、出版日期等信息，并支持按照关键词、分类等多种方式进行书籍的检索。主要功能是为用户提供电子书的搜索、查阅和管理，适用于图书馆、书店以及个人电子书收藏管理。数据库中包含两个表格：books1和books2，这两个表格都包含了书籍的基本信息和分类。
user: books1有多少数据
agent: 在我们的数据库中，books1表中存储了大约1,048,580条数据。这个表是电子书数据库的一部分，包含了电子书的书名、封面、出版社、作者、ISBN号和出版日期等信息。这些数据可以帮助用户进行电子书的搜索、查阅和管理。
user: 出现次数最多的图书TOP5
agent: 根据我们的数据库查询结果，出现次数最多的五本图书分别是：《大学计算机基础》出现了172次，位居第一；紧随其后的是《计算机应用基础》出现了164次；第三名是《C语言程序设计》出现了162次；第四名是《机械制图》出现了139次；最后《经济法》出现了137次。这些数据是通过合并books1和books2两个表中的书名，并计算每本书的出现次数得出的。这可以帮助我们了解哪些书籍在图书馆中较为热门。  
latest user query: 为什么这些书热门

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "为什么《大学计算机基础》、《计算机应用基础》、《C语言程序设计》、《机械制图》和《经济法》这些书籍在图书馆中热门？",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  为什么《大学计算机基础》、《计算机应用基础》、《C语言程序设计》、《机械制图》和《经济法》这些书籍在图书馆中热门？

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and LLM only",
  "reply": "《大学计算机基础》、《计算机应用基础》、《C语言程序设计》、《机械制图》和《经济法》这些书籍在图书馆中可能因为多种原因而热门。首先，这些书籍通常是大学课程中的必读材料，许多学生需要借阅这些书来完成课程学习。其次，这些书涵盖的都是基础知识，对初学者来说是必不可少的参考书籍。此外，这些领域（如计算机科学、机械工程和法律）是职业发展中需求量大的领域，因此相关书籍的需求也相对较高。"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: books1有多少数据
agent: 在我们的数据库中，books1表中存储了大约1,048,580条数据。这个表是电子书数据库的一部分，包含了电子书的书名、封面、出版社、作者、ISBN号和出版日期等信息。这些数据可以帮助用户进行电子书的搜索、查阅和管理。
user: 出现次数最多的图书TOP5
agent: 根据我们的数据库查询结果，出现次数最多的五本图书分别是：《大学计算机基础》出现了172次，位居第一；紧随其后的是《计算机应用基础》出现了164次；第三名是《C语言程序设计》出现了162次；第四名是《机械制图》出现了139次；最后《经济法》出现了137次。这些数据是通过合并books1和books2两个表中的书名，并计算每本书的出现次数得出的。这可以帮助我们了解哪些书籍在图书馆中较为热门。
user: 为什么这些书热门
agent: 《大学计算机基础》、《计算机应用基础》、《C语言程序设计》、《机械制图》和《经济法》这些书籍在图书馆中可能因为多种原因而热门。首先，这些书籍通常是大学课程中的必读材料，许多学生需要借阅这些书来完成课程学习。其次，这些书涵盖的都是基础知识，对初学者来说是必不可少的参考书籍。此外，这些领域（如计算机科学、机械工程和法律）是职业发展中需求量大的领域，因此相关书籍的需求也相对较高。  
latest user query: 小说中出现次数最多的TOP5

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "小说中出现次数最多的前五本书是哪些？",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |



- User’s natural language query:  
  小说中出现次数最多的前五本书是哪些？

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询书籍表中小说类书籍的出现次数，并列出出现次数最多的前五本书的名称和作者。",
  "explain_purpose": "用户想要知道在数据库中记录的小说类书籍中，哪些书的出现次数最多。通过统计每本书的出现次数并排序，可以找出出现次数最多的前五本书，从而回答用户的问题。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询书籍表中小说类书籍的出现次数，并列出出现次数最多的前五本书的名称和作者。  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                 |
|:--------------|:--------------|:-----------|:-------------------------------------------------------------------------|
| id            | bigint        |            | [247764, 606701, 272864]                                                 |
| damsid        | text          |            | ['60430286', '61559647', '60602351']                                     |
| damscode      | varchar(255)  | German     | ['LGX0011000-60430286', 'DHWYV22001-61559647', 'SD...                    |
| name          | varchar(255)  | Chinese    | ['网游之携美封圣', '知识与能力的凯歌——科技大发明（下册）', '筷子三千年'] |
| author        | varchar(255)  | Chinese    | ['欧阳玉清', '闻明，彭萍萍主编', '蓝翔著']                               |
| publisher     | varchar(255)  |            | ['<NA>', '中国环境科学出版社，学苑音像出版社', '山东教育出版社']         |
| publishdate   | text          |            | ['', '', '']                                                             |
| isbn          | varchar(255)  | hu         | ['<NA>', '7-80135-697-7', '7-5328-2817-4']                               |
| 中图法分类    | varchar(255)  | German     | ['<NA>', 'G624.61', 'G122']                                              |
| entitytypes   | varchar(255)  | vi         | ['TXT', 'PDF', 'PDF']                                                    |
| bookcover     | bigint        |            | [0, 0, 0]                                                                |
| keywords      | varchar(255)  |            | ['<NA>', '环境教育-小学-教材', '筷-文化-专题研究-中国']                  |


Table:books2
Description: 这是一个关于书籍信息的数据库表，包含书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                                                  |
|:--------------|:--------------|:-----------|:------------------------------------------------------------------------------------------|
| id            | bigint        |            | [1263813, 1233923, 1283373]                                                               |
| damsid        | varchar(255)  |            | ['SH00146560', 'SH00211480', 'SH00004854']                                                |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00146560', 'SHSHSH-SH00211480', 'SHSHSH...                                     |
| name          | varchar(255)  | Chinese    | ['别惹我的女朋友', '盖尔·吉本斯少儿百科系列：沙漠', '《千百年眼》中的另类中华史(上册)'... |
| author        | varchar(255)  | Chinese    | ['蝴蝶爱纯', '(美)盖尔·吉本斯', '（明）张燧 著,居索 译']                                  |
| publisher     | varchar(255)  |            | ['新星出版社', '译林出版社', '中国华侨出版社']                                            |
| publishdate   | text          |            | ['2005-01-01 00:00:00', '2014-03-01 00:00:00', '20...                                     |
| isbn          | varchar(255)  |            | ['7801488474', '9787544746465', '9786263629325']                                          |
| 中图法分类    | varchar(255)  | id         | ['I247.5', 'P941.73-49', 'K92']                                                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'EPUB', 'EPUB']                                                                  |
| bookcover     | bigint        |            | [0, 0, 0]                                                                                 |
| keywords      | varchar(255)  | Chinese    | ['长篇小说-中国-当代', '沙漠-少儿读物', '历史>中国史>中国通史']                           |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT name, author, COUNT(*) as count FROM (SELECT name, author FROM books1 WHERE keywords LIKE '%小说%' UNION ALL SELECT name, author FROM books2 WHERE keywords LIKE '%小说%') AS combined GROUP BY name, author ORDER BY count DESC LIMIT 5",
  "tables": ["books1", "books2"],
  "explanation": "这个查询首先从两个表books1和books2中选择所有关键词包含'小说'的书籍的名称和作者，然后将这些结果合并。接着，对合并后的结果按书名和作者分组，并计算每组的数量，最后按数量降序排序并选择出现次数最多的前五本书。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: 小说中出现次数最多的TOP5  
- Database schema: ebook
这个数据库存储了电子书的相关信息，包括书名、封面、出版社、作者、ISBN号、出版日期等。主要功能是为用户提供电子书的搜索、查阅和管理，支持按照关键词、分类等多种方式进行书籍的检索。适用于图书馆、书店以及个人电子书收藏管理。
Tables:
[books1,books2]  
- SQL executed: SELECT name, author, COUNT(*) as count FROM (SELECT name, author FROM books1 WHERE keywords LIKE '%小说%' UNION ALL SELECT name, author FROM books2 WHERE keywords LIKE '%小说%') AS combined GROUP BY name, author ORDER BY count DESC LIMIT 5  
- SQL result (first N rows if too many): total rows count: 5
+----------+--------------+---------+
| name     | author       |   count |
+==========+==============+=========+
| 三国演义 | (明)罗贯中著 |      26 |
+----------+--------------+---------+
| 西游记   | (明)吴承恩著 |      23 |
+----------+--------------+---------+
| 水浒传   | (明)施耐庵著 |      18 |
+----------+--------------+---------+
| 呼兰河传 | 萧红著       |      16 |
+----------+--------------+---------+
| 城南旧事 | 林海音著     |      14 |
+----------+--------------+---------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "根据我们的数据库查询结果，小说中出现次数最多的TOP5分别是：《三国演义》(明)罗贯中著出现26次，《西游记》(明)吴承恩著出现23次，《水浒传》(明)施耐庵著出现18次，《呼兰河传》萧红著出现16次，以及《城南旧事》林海音著出现14次。这个查询结果是通过对数据库中两个表books1和books2进行关键词搜索'小说'，然后统计每本书和作者的出现次数得到的。这些数据可以帮助我们了解哪些小说在图书馆中较为流行。",
  "followups": ["您想了解这些小说的具体内容或者其他相关信息吗？", "还有其他特定类型的书籍您想查询其流行度吗？"]
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |



- User’s natural language query:  
  你能干啥

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and LLM only",
  "reply": "您好！作为图书馆助理，我可以帮助您查询有关书籍、作者和图书馆资源的问题。如果您需要查找特定的书籍信息或者有关作者的详情，我可以协助您。此外，如果您需要执行特定的SQL查询来获取数据库中的信息，我也能提供帮助。请告诉我您具体需要查询什么信息？"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 你能干啥
agent: 您好！作为图书馆助理，我可以帮助您查询有关书籍、作者和图书馆资源的问题。如果您需要查找特定的书籍信息或者有关作者的详情，我可以协助您。此外，如果您需要执行特定的SQL查询来获取数据库中的信息，我也能提供帮助。请告诉我您具体需要查询什么信息？  
latest user query: 查一下作者名包含但丁的书

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "查询作者名中包含但丁的书籍",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |



- User’s natural language query:  
  查询作者名中包含但丁的书籍

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询包含'但丁'在作者名中的所有书籍的详细信息",
  "explain_purpose": "用户想要找到所有作者名中包含'但丁'的书籍，通过查询数据库可以获得这些书籍的详细信息，如书名、作者、出版社等，以满足用户的需求。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询包含'但丁'在作者名中的所有书籍的详细信息  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT * FROM books1 WHERE author LIKE '%但丁%' UNION SELECT * FROM books2 WHERE author LIKE '%但丁%'",
  "tables": ["books1", "books2"],
  "explanation": "查询两个表books1和books2中作者名包含'但丁'的所有书籍的详细信息。使用LIKE '%但丁%'来匹配包含'但丁'的作者名。使用UNION来合并两个查询结果。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: 查一下作者名包含但丁的书  
- Database schema: ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]  
- SQL executed: SELECT * FROM books1 WHERE author LIKE '%但丁%' UNION SELECT * FROM books2 WHERE author LIKE '%但丁%'  
- SQL result (first N rows if too many): total rows count: 38
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
|     id | damsid         | damscode              | name                            | author                                                                | publisher            | publishdate         | isbn              | 中图法分类            | entitytypes   |   bookcover | keywords                                                |
+========+================+=======================+=================================+=======================================================================+======================+=====================+===================+=======================+===============+=============+=========================================================+
|  28684 | 351361         | BJZT00-351361         | 神曲的故事                      | [意] 但丁/原著, [意] 波提切利, [英] 布莱克, [法] 多雷等/绘, 刘世军/译 | 陕西师范大学出版社   | 2004-01-31 00:00:00 | 978-7-5613-2696-1 | I546.23               | PDF           |           0 | 史诗 -- 意大利 -- 中世纪                                |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
|  31711 | 351398         | BJZT00-351398         | 神曲 故事插图本                 | [意] 但丁/原著, [法] 多雷/绘                                          | 陕西师范大学出版社   | 1998-09-30 00:00:00 | 7-5613-2459-6     | I546.23 ; J238.5(565) | PDF           |           0 | 史诗 -- 意大利 -- 中世纪 ; 插图 -- 法国 -- 近代 -- 画册 |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 132464 | 60431294       | SZSJ00-60431294       | 神曲                            | (意)但丁(Dante Alighieri)著                                           | 译文出版社           |                     | 9787532758937     | I546.23               | PDF           |           0 | 史诗 -- 意大利 -- 中世纪                                |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 171356 | 335825         | SZSJ00-335825         | 神曲                            | (意)但丁                                                              | 上海译文出版社       |                     | 978-7-5327-5252-2 | I546.23               | PDF           |           0 | 史诗--意大利--中世纪                                    |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 330294 | 60668864       | LNMXC22001-60668864   | 神曲·炼狱篇                     | (意) 但丁著                                                           | 辽宁人民出版社       |                     | 978-7-205-07955-0 | H319.4：I             | PDF           |           0 | 英语-语言读物;-史诗-意大利-中世纪                       |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 330529 | 60668883       | LNMXC22001-60668883   | 神曲·天堂篇                     | (意) 但丁著                                                           | 辽宁人民出版社       |                     | 978-7-205-08449-3 | H319.4：I             | PDF           |           0 | 英语-语言读物;-史诗-意大利-中世纪                       |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 331397 | 60668853       | LNMXC22001-60668853   | 神曲·地狱篇                     | (意) 但丁著                                                           | 辽宁人民出版社       |                     | 978-7-205-07683-2 | H319.4：I             | PDF           |           0 | 英语-语言读物;-史诗-意大利-中世纪                       |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 367200 | 60815737       | SCWYC22001-60815737   | 神曲                            | (意)但丁著                                                            | 四川文艺出版社       |                     | 978-7-5411-4493-6 | I546.23               | PDF           |           0 | 诗歌-意大利-中世纪                                      |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 398771 | 60927828       | BJZTT22000-60927828   | 神曲的故事（插图珍藏本）        | (意)但丁原著                                                          | 甘肃人民美术出版社   |                     | 978-7-5527-0364-1 | I546.23               | PDF           |           0 | 诗歌-意大利-中世纪                                      |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 437751 | 61178633       | BJXHX22001-61178633   | 神曲                            | (意)但丁著                                                            | 北京联合出版公司     |                     | 978-7-5502-6826-5 | I546.23               | PDF           |           0 | 史诗-意大利-中世纪                                      |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 457396 | 61201234       | LNMXC22001-61201234   | 神曲·炼狱篇                     | (意)但丁(Dante Alighieri)著                                           | 辽宁人民出版社       |                     | 978-7-205-07955-0 | H319.4：I             | PDF           |           0 | 英语-语言读物;-史诗-意大利-中世纪                       |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 457427 | 61201350       | LNMXC22001-61201350   | 神曲·天堂篇                     | (意)但丁(Dante Alighieri)著                                           | 辽宁人民出版社       |                     | 978-7-205-08449-3 | H319.4：I             | PDF           |           0 | 英语-语言读物;-史诗-意大利-中世纪                       |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 464261 | 61201211       | LNMXC22001-61201211   | 神曲·地狱篇                     | (意)但丁(Dante, A. )著                                                | 辽宁人民出版社       |                     | 978-7-205-07683-2 | H319.4：I             | TXT,EPUB      |           0 | 英语-语言读物;-史诗-意大利-中世纪                       |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 509670 | 60824435       | ZBJTS22001-60824435   | 艺术大师讲述世界名著的故事:神曲 | ［意］但丁                                                            | 陕西师范大学出版社   |                     | 7-5613-2459-6     | I546.23               | PDF           |           0 | 诗歌-意大利-中世纪                                      |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 510416 | 60819947       | ZBJTS22001-60819947   | 神曲                            | 但丁                                                                  | 内蒙古少年儿童出版社 | 2001-08-13 00:00:00 | 7-5312-1364-8     | <NA>                  | PDF           |           0 | <NA>                                                    |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 514611 | 61272496       | HDSFD22000-61272496   | 生命之殿                        | (英)但丁·罗塞蒂(Dante Rossetti)著                                     | 华东师范大学出版社   |                     | 978-7-5675-7566-0 | I561.24               | EPUB          |           0 | 十四行诗-诗集-英国-近代                                 |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 637129 | 63689983       | LNMXC22001-63689983   | 神曲·炼狱篇                     | (意)但丁(Dante Alighieri)著                                           | 辽宁人民出版社       |                     | 978-7-205-07955-0 | H319.4：I             | PDF           |           0 | 英语-语言读物;-史诗-意大利-中世纪                       |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 637131 | 63690004       | LNMXC22001-63690004   | 神曲·天堂篇                     | (意)但丁(Dante Alighieri)著                                           | 辽宁人民出版社       |                     | 978-7-205-08449-3 | H319.4：I             | PDF           |           0 | 英语-语言读物;-史诗-意大利-中世纪                       |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 639603 | 63689973       | LNMXC22001-63689973   | 神曲·地狱篇                     | (意)但丁(Dante, A. )著                                                | 辽宁人民出版社       |                     | 978-7-205-07683-2 | H319.4：I             | EPUB          |           0 | 英语-语言读物;-史诗-意大利-中世纪                       |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+
| 742723 | sdsdeb000cf640 | sdsdeb-sdsdeb000cf640 | 君主国                          | [意]但丁著                                                            | 中国政法大学出版社   | 2003-08-13 00:00:00 | 978-5620-2365-4   | D095.463              | PDF           |           0 | 政治思想史－意大利－中世纪－英文                        |
+--------+----------------+-----------------------+---------------------------------+-----------------------------------------------------------------------+----------------------+---------------------+-------------------+-----------------------+---------------+-------------+---------------------------------------------------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "根据数据库查询结果，共找到38本包含作者名“但丁”的书籍。这些书籍主要是关于但丁的著名作品《神曲》的不同版本和翻译，包括《神曲·地狱篇》、《神曲·炼狱篇》和《神曲·天堂篇》等。出版社包括陕西师范大学出版社、辽宁人民出版社等，书籍多为PDF格式。这些书籍的关键词通常包括“史诗”，“意大利”，“中世纪”，表明这些书籍主要涉及中世纪意大利的史诗类文学作品。如果您需要了解某本具体书籍的详细信息，如出版日期或具体内容，请告知书名或ISBN号。"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 你能干啥
agent: 您好！作为图书馆助理，我可以帮助您查询有关书籍、作者和图书馆资源的问题。如果您需要查找特定的书籍信息或者有关作者的详情，我可以协助您。此外，如果您需要执行特定的SQL查询来获取数据库中的信息，我也能提供帮助。请告诉我您具体需要查询什么信息？
user: 查一下作者名包含但丁的书
agent: 根据数据库查询结果，共找到38本包含作者名“但丁”的书籍。这些书籍主要是关于但丁的著名作品《神曲》的不同版本和翻译，包括《神曲·地狱篇》、《神曲·炼狱篇》和《神曲·天堂篇》等。出版社包括陕西师范大学出版社、辽宁人民出版社等，书籍多为PDF格式。这些书籍的关键词通常包括“史诗”，“意大利”，“中世纪”，表明这些书籍主要涉及中世纪意大利的史诗类文学作品。如果您需要了解某本具体书籍的详细信息，如出版日期或具体内容，请告知书名或ISBN号。  
latest user query: 有没有书名不含神曲的

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "continue",
  "rewritten": "查询书名不包含《神曲》的但丁的书籍",
  "direct_reply": null
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |



- User’s natural language query:  
  查询书名不包含《神曲》的但丁的书籍

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询所有作者名为但丁，且书名不包含《神曲》的书籍信息",
  "explain_purpose": "用户想要找到所有由但丁所写，但书名中不包含《神曲》的书籍。通过查询数据库，我们可以找到符合这些条件的书籍列表，从而满足用户的需求。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询所有作者名为但丁，且书名不包含《神曲》的书籍信息  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT * FROM books2 WHERE author = '但丁' AND name NOT LIKE '%神曲%'",
  "tables": ["books2"],
  "explanation": "查询表books2中作者为但丁且书名不包含《神曲》的所有书籍信息。"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 你能干啥
agent: 您好！作为图书馆助理，我可以帮助您查询有关书籍、作者和图书馆资源的问题。如果您需要查找特定的书籍信息或者有关作者的详情，我可以协助您。此外，如果您需要执行特定的SQL查询来获取数据库中的信息，我也能提供帮助。请告诉我您具体需要查询什么信息？
user: 查一下作者名包含但丁的书
agent: 根据数据库查询结果，共找到38本包含作者名“但丁”的书籍。这些书籍主要是关于但丁的著名作品《神曲》的不同版本和翻译，包括《神曲·地狱篇》、《神曲·炼狱篇》和《神曲·天堂篇》等。出版社包括陕西师范大学出版社、辽宁人民出版社等，书籍多为PDF格式。这些书籍的关键词通常包括“史诗”，“意大利”，“中世纪”，表明这些书籍主要涉及中世纪意大利的史诗类文学作品。如果您需要了解某本具体书籍的详细信息，如出版日期或具体内容，请告知书名或ISBN号。
user: 有没有书名不含神曲的
agent: something went wrong, please try again.  
latest user query: 出错了？

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

```json
{
  "intent": "confirm",
  "rewritten": null,
  "direct_reply": "是的，出现了一点问题，请您稍后再试。"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 查一下作者名包含但丁的书
agent: 根据数据库查询结果，共找到38本包含作者名“但丁”的书籍。这些书籍主要是关于但丁的著名作品《神曲》的不同版本和翻译，包括《神曲·地狱篇》、《神曲·炼狱篇》和《神曲·天堂篇》等。出版社包括陕西师范大学出版社、辽宁人民出版社等，书籍多为PDF格式。这些书籍的关键词通常包括“史诗”，“意大利”，“中世纪”，表明这些书籍主要涉及中世纪意大利的史诗类文学作品。如果您需要了解某本具体书籍的详细信息，如出版日期或具体内容，请告知书名或ISBN号。
user: 有没有书名不含神曲的
agent: something went wrong, please try again.
user: 出错了？
agent: 是的，出现了一点问题，请您稍后再试。  
latest user query: 好吧，那先这样

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

{
  "intent": "end",
  "rewritten": null,
  "direct_reply": null
}
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 有没有书名不含神曲的
agent: something went wrong, please try again.
user: 出错了？
agent: 是的，出现了一点问题，请您稍后再试。
user: 好吧，那先这样
agent: thanks, let's end the conversation.  
latest user query: 给我执行SQL select * from books1 limit 5

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

```json
{
  "intent": "continue",
  "rewritten": "执行SQL查询：select * from books1 limit 5",
  "direct_reply": null
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |



- User’s natural language query:  
  执行SQL查询：select * from books1 limit 5

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询books1表中的前5条记录",
  "explain_purpose": "用户请求执行一个SQL查询以获取books1表中的前5条书籍记录。通过执行这个查询，我们可以提供用户所需的书籍信息。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询books1表中的前5条记录  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT * FROM books1 LIMIT 5;",
  "tables": ["books1"],
  "explanation": "查询books1表中的前5条记录。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table6** as a placeholder.  

### Input
- User question: 给我执行SQL select * from books1 limit 5  
- Database schema: ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]  
- SQL executed: SELECT * FROM books1 LIMIT 5;  
- SQL result (first N rows if too many): total rows count: 5
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|   id |     damsid | damscode              | name                                     | author   | publisher          | publishdate         | isbn              | 中图法分类   | entitytypes   |   bookcover | keywords                             |
+======+============+=======================+==========================================+==========+====================+=====================+===================+==============+===============+=============+======================================+
|    3 | 3001819939 | HBGLS22000-3001819939 | 卓越学校的支撑——河北衡水中学制度建设概览 | 张文茂   | 河北教育出版社     |                     | 978-7-5434-9814-3 | G637         | PDF           |           0 | 中学 -- 学校管理 -- 制度建设 -- 衡水 |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    4 |     131898 | BJNM00-131898         | 代理在世界中                             | 读书堂   | 岳麓出版社         | 2008-06-01 00:00:00 | 978-7-80665-428-5 | F7           | PDF,TXT       |           0 | 代理在世界中                         |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    5 | 3001820484 | HBGLS22000-3001820484 | 野兽岛                                   | 安伟邦   | 河北少年儿童出版社 |                     | 978-7-5376-4595-9 | I18          | PDF           |           0 | 世界文学 -- 儿童文学 -- 作品综合集   |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    6 |     106874 | BJNM00-106874         | BOBO新论                                 | 读书堂   | 昆仑出版社         | 2008-06-01 00:00:00 | 978-7-80040-583-6 | C913         | PDF,TXT       |           0 | <NA>                                 |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+
|    7 |     132138 | BJNM00-132138         | 历届奥运会比赛成绩05                     | okbooks  | <NA>               |                     | <NA>              | G8           | PDF,TXT       |           0 | 历届奥运会比赛成绩05                 |
+------+------------+-----------------------+------------------------------------------+----------+--------------------+---------------------+-------------------+--------------+---------------+-------------+--------------------------------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "您查询的是数据库中表books1的前5条记录。这个表包含了电子书的详细信息，如书名、作者、出版社、出版日期、ISBN号码、中图法分类、电子书格式（如PDF, TXT等）、书籍封面（数字表示是否有封面）以及关键词等。例如，第一条记录是关于《卓越学校的支撑——河北衡水中学制度建设概览》这本书，作者是张文茂，出版社为河北教育出版社，书籍的中图法分类为G637，格式为PDF，关键词包括中学、学校管理、制度建设和衡水等。这些信息有助于用户了解每本书的基本情况，并可以用于搜索、查看和购买电子书。如果您需要更多关于这些书籍的信息或有其他查询需求，请告诉我。",
  "followups": ["您需要查询其他书籍的详细信息吗？", "有没有特定的书籍或作者您想了解更多信息？"]
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 出错了？
agent: 是的，出现了一点问题，请您稍后再试。
user: 好吧，那先这样
agent: thanks, let's end the conversation.
user: 给我执行SQL select * from books1 limit 5
agent: 您查询的是数据库中表books1的前5条记录。这个表包含了电子书的详细信息，如书名、作者、出版社、出版日期、ISBN号码、中图法分类、电子书格式（如PDF, TXT等）、书籍封面（数字表示是否有封面）以及关键词等。例如，第一条记录是关于《卓越学校的支撑——河北衡水中学制度建设概览》这本书，作者是张文茂，出版社为河北教育出版社，书籍的中图法分类为G637，格式为PDF，关键词包括中学、学校管理、制度建设和衡水等。这些信息有助于用户了解每本书的基本情况，并可以用于搜索、查看和购买电子书。如果您需要更多关于这些书籍的信息或有其他查询需求，请告诉我。  
latest user query: 请问你的数据库能做什么分析

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

```json
{
  "intent": "continue",
  "rewritten": "请问数据库能进行哪些分析？",
  "direct_reply": null
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |



- User’s natural language query:  
  请问数据库能进行哪些分析？

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and LLM only",
  "reply": "数据库可以进行多种分析，主要取决于您希望从数据中获取什么样的信息。例如，可以分析特定作者的书籍销售情况，查看不同出版社出版的书籍数量，或者根据出版日期来分析书籍的发布趋势。此外，还可以通过关键词来分析书籍的主题和流行内容。具体的分析功能还需要根据具体的查询需求来确定。"
}
```
------------
You are an assistant that processes multi-turn conversations and classifies the user’s latest message.
Your task is to determine the intent and decide whether to rewrite or directly reply.

### Rules

1. Intent categories:

  - end: The user wants to end the conversation (e.g., “谢谢”, “再见”).

    Action: Output only the intent, directly say bye to the user.

  - confirm: The user questions or asks for confirmation about the previous reply (e.g., “Are you sure?”, “Is this true?”).

    Action: Output only the intent, and directly reply to the user based on conversation history in Chinese, without rewriting into a standalone query.

  - continue: The user continues the conversation and asks for more information (e.g., “Then who are the main characters in this novel?”).

    Action: Rewrite the user’s message into a standalone query that does not depend on previous context in Chinese.

2. Output strictly in JSON format, without any additional text or explanation.

### Input:
The conversation is provided as alternating turns:
user: 好吧，那先这样
agent: thanks, let's end the conversation.
user: 给我执行SQL select * from books1 limit 5
agent: 您查询的是数据库中表books1的前5条记录。这个表包含了电子书的详细信息，如书名、作者、出版社、出版日期、ISBN号码、中图法分类、电子书格式（如PDF, TXT等）、书籍封面（数字表示是否有封面）以及关键词等。例如，第一条记录是关于《卓越学校的支撑——河北衡水中学制度建设概览》这本书，作者是张文茂，出版社为河北教育出版社，书籍的中图法分类为G637，格式为PDF，关键词包括中学、学校管理、制度建设和衡水等。这些信息有助于用户了解每本书的基本情况，并可以用于搜索、查看和购买电子书。如果您需要更多关于这些书籍的信息或有其他查询需求，请告诉我。
user: 请问你的数据库能做什么分析
agent: 数据库可以进行多种分析，主要取决于您希望从数据中获取什么样的信息。例如，可以分析特定作者的书籍销售情况，查看不同出版社出版的书籍数量，或者根据出版日期来分析书籍的发布趋势。此外，还可以通过关键词来分析书籍的主题和流行内容。具体的分析功能还需要根据具体的查询需求来确定。  
latest user query: 给我分析书籍的发布趋势

### Output Format (JSON):
```json
{
  "intent": "<end|confirm|continue>",
  "rewritten": "<standalone query or null>",
  "direct_reply": "<reply to user or null>"
}
```

```json
{
  "intent": "continue",
  "rewritten": "分析书籍的发布趋势",
  "direct_reply": null
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |



- User’s natural language query:  
  分析书籍的发布趋势

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "统计每年发布的书籍数量",
  "explain_purpose": "通过统计每年发布的书籍数量，我们可以分析出书籍的发布趋势，从而回答用户的原始问题。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
统计每年发布的书籍数量  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT EXTRACT(YEAR FROM publishdate::date) AS year, COUNT(*) AS book_count FROM books2 GROUP BY year ORDER BY year;",
  "tables": ["books2"],
  "explanation": "此查询使用books2表，通过publishdate字段提取年份，并计算每个年份发布的书籍数量。结果按年份排序。"
}
```
------------
