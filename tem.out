You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |



- User’s natural language query:  
  有多少本跟神曲相关的书

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询包含关键词'神曲'的书籍数量",
  "explain_purpose": "用户想要知道数据库中与'神曲'相关的书籍有多少本，通过查询包含此关键词的书籍数量，可以直接回答用户的问题。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询包含关键词'神曲'的书籍数量  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT COUNT(*) FROM books1 WHERE keywords LIKE '%神曲%' UNION ALL SELECT COUNT(*) FROM books2 WHERE keywords LIKE '%神曲%'",
  "tables": ["books1", "books2"],
  "explanation": "查询表books1和books2中包含关键词'神曲'的书籍数量。使用LIKE '%神曲%'来匹配包含'神曲'的记录。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table5** as a placeholder.  

### Input
- User question: 有多少本跟神曲相关的书  
- Database schema: ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]  
- SQL executed: SELECT COUNT(*) FROM books1 WHERE keywords LIKE '%神曲%' UNION ALL SELECT COUNT(*) FROM books2 WHERE keywords LIKE '%神曲%'  
- SQL result (first N rows if too many): total rows count: 2
+------------+
|   COUNT(*) |
+============+
|          1 |
+------------+
|          0 |
+------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

{
  "reply": "根据我们的数据库查询结果，与‘神曲’相关的书籍共有1本。这个结果是通过检索两个表格books1和books2中包含关键词‘神曲’的书籍来得到的。在books1表中找到了1本相关书籍，而在books2表中没有找到相关书籍。如果您需要更多关于这本书的详细信息或者有其他任何问题，请随时提问。",
  "followups": ["您想了解这本与‘神曲’相关的书的具体信息吗？", "还有其他特定主题的书籍您想查询吗？"]
}
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |



- User’s natural language query:  
  有多少本跟神曲相关的书

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "Yes and DB query",
  "new_question": "查询所有包含'神曲'关键词的书籍数量",
  "explain_purpose": "用户询问与'神曲'相关的书籍数量，通过查询数据库中书籍的关键词字段，可以统计出含有'神曲'关键词的书籍总数，从而回答用户的问题。"
}
```
------------
You are an intelligent SQL query assistant.  
Your job is to convert a user’s natural language question into an executable SQL query, using the given database schema.  

### Instructions:

1. **Understand the query**  
   - Identify intent and map it to the correct tables/fields.  
   - If the query contains vague terms (e.g., “recent”, “reasonable price”, “big clients”) or domain-specific language that cannot be directly mapped, ask the user for clarification in Chinese before generating SQL.  

2. **Write SQL**  
   - Once clarified, generate a valid SQL query strictly based on the schema.  
   - Ensure correct syntax and accurate filtering logic.  
   - Briefly explain in Chinese which tables are used and what the conditions mean.

### Notes:
- Do not show reasoning steps.  
- Output only the JSON in the specified format.  

### Input:
- **User Query:** 
查询所有包含'神曲'关键词的书籍数量  

- **Database schema** (tables and fields): 

Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |

  


### Output (JSON):
```json
{
  "type": "sql | unclear", // indicates whether the output is a SQL query or a clarification request
  "reply": "Generated SQL query, or a clarification request in Chinese",
  "tables": ["table1", "table2", "..."]   // array of table names, empty if not applicable
  "explanation": "Explanation in Chinese" // tables are used and what the conditions mean
}
```
```json
{
  "type": "sql",
  "reply": "SELECT COUNT(*) FROM books1 WHERE keywords LIKE '%神曲%' UNION ALL SELECT COUNT(*) FROM books2 WHERE keywords LIKE '%神曲%'",
  "tables": ["books1", "books2"],
  "explanation": "查询表books1和books2中包含'神曲'关键词的书籍数量。使用LIKE '%神曲%'来匹配包含'神曲'的记录。"
}
```
------------

You are a **Library Assistant**.  
The user has asked a question related to the local database. You have already executed an SQL query and obtained results. Now, you must use both the SQL results and your own knowledge to answer the user’s question.

### Instructions
1. Use the SQL results as supporting evidence.  
2. Combine them with your knowledge when answering.  
   - If the answer relies on SQL results, explain the meaning of the SQL output, including which tables are used and what the query conditions represent.  
   - If the SQL results and your knowledge together are insufficient, clearly tell the user that you cannot answer.  
3. Suggest follow-up questions if appropriate.  
4. When referencing SQL results, never output raw data. Always use **temp_table5** as a placeholder.  

### Input
- User question: 有多少本跟神曲相关的书  
- Database schema: ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]  
- SQL executed: SELECT COUNT(*) FROM books1 WHERE keywords LIKE '%神曲%' UNION ALL SELECT COUNT(*) FROM books2 WHERE keywords LIKE '%神曲%'  
- SQL result (first N rows if too many): total rows count: 2
+------------+
|   COUNT(*) |
+============+
|          1 |
+------------+
|          0 |
+------------+  

### Output (JSON):
```json
{
  "reply": "Answer and explanation if any, in Chinese",
  "followups": ["Follow-up 1", "Follow-up 2"] // optional, can be empty
}
```

```json
{
  "reply": "根据我们的数据库查询结果，与‘神曲’相关的书共有1本。这个查询涉及了两个表格：books1和books2。我们使用了关键词搜索，确保只计算包含‘神曲’关键字的书籍。在books1表中找到了1本相关书籍，而在books2表中没有找到相关书籍。如果您需要更多关于这本书的信息，或者想了解其他相关书籍，请告诉我。",
  "followups": ["您想了解这本书的具体信息吗？", "还有其他特定的书籍或主题您想查询吗？"]
}
```
------------
You are an NL2SQL conversation rewriter.  
Your task is to transform a multi-turn conversation between a user and an NL2SQL agent into independent single-turn queries.  
Each user utterance must be classified into one of the following categories and rewritten accordingly:  

1. **continue** – The user wants to refine, extend, or adjust the previous SQL query (e.g., add conditions, change constraints, include extra fields).  
   - **action**: Summarize how the current SQL should be modified, including concrete SQL operation guidance (e.g., "Add WHERE city='Beijing'", "Include column total_sales", "Modify ORDER BY date DESC").  

2. **sql_fix** – The user is correcting a previous SQL that produced errors, no results, or incorrect output.  
   - **action**: Summarize how the SQL should be corrected, including concrete SQL modification steps (e.g., "Change column name from 'totalsale' to 'total_sales'", "Fix syntax error in JOIN clause").  

3. **confirm** – The user is confirming or acknowledging the previous reply.  
   - **action**: directly reply to the user based on conversation history in Chinese.  

4. **new** – The user is starting a brand-new query that does not depend on previous turns.  
   - **action**: Rewrite it into a fully independent natural language query.  

5. **end** – The user ends the conversation.  
   - **action**: directly say bye to the user in Chinese.  

### Input:
The conversation is provided as alternating turns:
user: 有多少本跟神曲相关的书
agent: SELECT COUNT(*) FROM books1 WHERE keywords LIKE '%神曲%' UNION ALL SELECT COUNT(*) FROM books2 WHERE keywords LIKE '%神曲%'根据我们的数据库查询结果，与‘神曲’相关的书共有1本。这个查询涉及了两个表格：books1和books2。我们使用了关键词搜索，确保只计算包含‘神曲’关键字的书籍。在books1表中找到了1本相关书籍，而在books2表中没有找到相关书籍。如果您需要更多关于这本书的信息，或者想了解其他相关书籍，请告诉我。  
latest user query: 2000年以后出版的


### Output Format  
For each user turn, output a JSON object with the following structure:  

```json
{
  "type": "continue | sql_fix | confirm | new | end",
  "action": "summary or rewritten query as required"
}
```

```json
{
  "type": "continue",
  "action": "Add WHERE condition to filter books published after the year 2000"
}
```
------------
You are a helpful and knowledgeable Library Assistant. Your responsibilities include:
- Answer questions about books, authors, and library resources.
- 执行用户直接给出的SQL查询，并解释SQL的含义。
- Support users in searching and locating information efficiently.

You have the following capabilities:
- Querying a local database (structured information with tables and fields).
- Using large language model reasoning and knowledge to supplement and expand information.

### Your Current Tasks:

1. **Query Analysis**  
   - First, check whether the user’s request is relevant to your responsibilities.  
   - If irrelevant, politely explain that you are not responsible for this type of task. Set `"relevance": "no"`.   
   - If the user’s intent is unclear, ask clarifying questions. Set `"relevance": "unclear"`. 

2. **Relevance Determination**  
   - If the request is relevant but does **not** require the local database, answer directly using LLM reasoning in **Chinese**.  
     Set `"relevance": "Yes and LLM only"`.  
   - If the request is relevant and **does** require the local database, provide:  
     - `new_question`: a natural language query (not SQL) in Chinese, describing precisely what information should be retrieved from the database.  
     - `explain_purpose`: a short explanation in Chinese, describing how the results of `new_question` will help answer the user’s original question.  
     Set `"relevance": "Yes and DB query"`. In this case, leave `"reply"` empty.
  - if the user directly provides an SQL query, 判断查询的tables和字段是否在schema中，若不在则relevance设为no，若在则设为Yes and DB query

### Input:
- Database description:  
  ebook
这个数据库主要存储电子书的信息，包括书籍的ISBN号、出版日期、作者、出版社等。它的主要功能是为电子商务平台提供书籍信息管理，支持用户搜索、查看和购买电子书。此外，数据库还能帮助出版社和作者管理和分析书籍的销售情况。
Tables:
[books1,books2]

- Tables and fields descriptions:  
  Table:books1
Description: 这是一个包含书籍信息的数据表，涵盖书籍的基本属性和相关元数据。
| column_name   | column_type   | val_lang   | examples                                              |
|:--------------|:--------------|:-----------|:------------------------------------------------------|
| id            | bigint        |            | [656, 166211, 666629]                                 |
| damsid        | text          |            | ['43995', '60522481', 'sdsdeb00020266']               |
| damscode      | varchar(255)  | Danish     | ['HACA10-43995', 'QDYMS22000-60522481', 'sdsdeb-sd... |
| name          | varchar(255)  | Chinese    | ['花房', '可怕的广东人', '毛泽东的老师们']            |
| author        | varchar(255)  | ko         | ['韩放', '伍豪主编', '尹高朝;']                       |
| publisher     | varchar(255)  |            | ['<NA>', '中国长安出版社', '<NA>']                    |
| publishdate   | text          |            | ['', '', '']                                          |
| isbn          | varchar(255)  | hu         | ['<NA>', '978-7-5107-0330-0', '978-114-04147-0']      |
| 中图法分类    | varchar(255)  | Welsh      | ['<NA>', 'C955.2', 'G4']                              |
| entitytypes   | varchar(255)  | vi         | ['PDF,TXT', ',TXT', 'PDF']                            |
| bookcover     | bigint        |            | [0, 0, 0]                                             |
| keywords      | varchar(255)  | ko         | ['花房；韩放', '民族性', '<NA>']                      |


Table:books2
Description: 这是一个关于书籍的数据库表，包含了书籍的基本信息和分类。
| column_name   | column_type   | val_lang   | examples                                                  |
|:--------------|:--------------|:-----------|:----------------------------------------------------------|
| id            | bigint        |            | [1251183, 1368212, 1265228]                               |
| damsid        | varchar(255)  |            | ['SH00192394', '80064023', 'SH00143394']                  |
| damscode      | varchar(255)  |            | ['SHSHSH-SH00192394', 'HXGYC22000-80064023', 'SHSH...     |
| name          | varchar(255)  |            | ['大故宫3', '废催化剂污染管理与资源化', '被风吹落的夏天'] |
| author        | varchar(255)  | Chinese    | ['阎崇年', '杨骥，邱兆富，张巍，曹礼梅编著', 'Q点调皮']   |
| publisher     | varchar(255)  | ko         | ['长江文艺出版社', '化学工业出版社', '<NA>']              |
| publishdate   | text          |            | ['2013-01-01 00:00:00', '', '2014-02-08 00:00:00']        |
| isbn          | varchar(255)  | hu         | ['9787535462367', '978-7-122-41230-0', '<NA>']            |
| 中图法分类    | varchar(255)  |            | ['K203;K928.74', 'X78', '<NA>']                           |
| entitytypes   | varchar(255)  | German     | ['EPUB', 'PDF', 'EPUB']                                   |
| bookcover     | bigint        |            | [0, 0, 0]                                                 |
| keywords      | varchar(255)  | Chinese    | ['文化遗产-介绍-中国;-故宫-介绍', '<NA>', '<NA>']         |



- User’s natural language query:  
  Add WHERE condition to filter books published after the year 2000

### Output (JSON):
```json
{
  "relevance": "no / unclear / Yes and LLM only / Yes and DB query",
  "reply": "If 'Yes and LLM only', provide the LLM-generated answer in Chinese. If 'No' or 'Unclear', reply in Chinese as instructed.",
  "new_question": "If 'Yes and DB query', provide the natural language query in Chinese.",
  "explain_purpose": "If 'Yes and DB query', explain in Chinese how the database results help answer the original question."
}

```

```json
{
  "relevance": "unclear",
  "reply": "请问您是希望查询哪本书或者哪类书籍在2000年后出版的信息吗？能否提供更多具体的信息或条件？"
}
```
------------
